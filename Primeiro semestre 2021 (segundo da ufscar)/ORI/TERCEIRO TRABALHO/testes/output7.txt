-- OPERAÇÕES CONTEMPLADAS PELO CASO DE TESTE:
-- (COM ARQUIVO DE CLIENTES)
-- REMOÇÃO DE CHAVE PIX
-- BUSCAR CLIENTE POR CHAVE PIX
-- IMPRIMIR ARQUIVO DE CLIENTES
-- IMPRIMIR ÍNDICE DE CLIENTES
-- IMPRIMIR ÍNDICE DE CHAVES PIX

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;mariaeugenia@gmail.com;15998765645;0000000000.00;A97301660-afcb-4ea4-a5a6-7c3abe8b8fbb&C66545678765&N15998765645&Emariaeugenia@gmail.com;##################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;C99876556782&Ega.augusto@gmail.com;#######################################################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;Ege.santana@gmail.com&C44565434213;#######################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;N14998786754&Egalmeida@gmail.com;###########################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;Emelissa@gmail.com&A4064b4e3-53ac-4469-a819-708177365752&C14565436782;#######################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {4064b4e3-53ac-4469-a819-708177365752, 14565436782} {99876556782, 99876556782} {mariaeugenia@gmail.com, 66545678765}
[1] {14998786754, 54654367865} {66545678765, 66545678765}
[2] {44565434213, 44565434213} {ge.santana@gmail.com, 44565434213}
[3] {97301660-afcb-4ea4-a5a6-7c3abe8b8fbb, 66545678765} {melissa@gmail.com, 14565436782}
[4] {15998765645, 66545678765} {galmeida@gmail.com, 54654367865}
[5]
[6] {14565436782, 14565436782} {ga.augusto@gmail.com, 99876556782}

-- buscando por chaves PIX
SELECT * FROM clientes WHERE '97301660-afcb-4ea4-a5a6-7c3abe8b8fbb' = ANY (chaves_pix);
Indices percorridos: 3 0
Indices percorridos: 9
66545678765, Maria Eugenia, 12/04/1980, mariaeugenia@gmail.com, 15998765645, 0.00, {A97301660-afcb-4ea4-a5a6-7c3abe8b8fbb, C66545678765, N15998765645, Emariaeugenia@gmail.com}
SELECT * FROM clientes WHERE '99876556782' = ANY (chaves_pix);
Indices percorridos: 0 0 1
Indices percorridos: 5
99876556782, Gabriel Augusto, 04/05/1997, ga.augusto@gmail.com, 15997675654, 0.00, {C99876556782, Ega.augusto@gmail.com}
SELECT * FROM clientes WHERE 'ga.augusto@gmail.com' = ANY (chaves_pix);
Indices percorridos: 6 0 1
Indices percorridos: 5
99876556782, Gabriel Augusto, 04/05/1997, ga.augusto@gmail.com, 15997675654, 0.00, {C99876556782, Ega.augusto@gmail.com}
SELECT * FROM clientes WHERE '44565434213' = ANY (chaves_pix);
Indices percorridos: 2 0
Indices percorridos: 6
44565434213, Geovana Santana, 25/10/1994, ge.santana@gmail.com, 16996543652, 0.00, {Ege.santana@gmail.com, C44565434213}
SELECT * FROM clientes WHERE 'mariaeugenia@gmail.com' = ANY (chaves_pix);
Indices percorridos: 0 0 1 2
Indices percorridos: 9
66545678765, Maria Eugenia, 12/04/1980, mariaeugenia@gmail.com, 15998765645, 0.00, {A97301660-afcb-4ea4-a5a6-7c3abe8b8fbb, C66545678765, N15998765645, Emariaeugenia@gmail.com}
SELECT * FROM clientes WHERE 'melissa@gmail.com' = ANY (chaves_pix);
Indices percorridos: 3 0 1
Indices percorridos: 9 10
14565436782, Melissa Pereira, 19/09/1993, melissa@gmail.com, 15997654738, 0.00, {Emelissa@gmail.com, A4064b4e3-53ac-4469-a819-708177365752, C14565436782}
SELECT * FROM clientes WHERE '14998786754' = ANY (chaves_pix);
Indices percorridos: 1 0
Indices percorridos: 1
54654367865, Gustavo Almeida, 19/11/1992, galmeida@gmail.com, 14998786754, 0.00, {N14998786754, Egalmeida@gmail.com}
SELECT * FROM clientes WHERE '4064b4e3-53ac-4469-a819-708177365752' = ANY (chaves_pix);
Indices percorridos: 0 0
Indices percorridos: 9 10
14565436782, Melissa Pereira, 19/09/1993, melissa@gmail.com, 15997654738, 0.00, {Emelissa@gmail.com, A4064b4e3-53ac-4469-a819-708177365752, C14565436782}
SELECT * FROM clientes WHERE 'galmeida@gmail.com' = ANY (chaves_pix);
Indices percorridos: 4 0 1
Indices percorridos: 1
54654367865, Gustavo Almeida, 19/11/1992, galmeida@gmail.com, 14998786754, 0.00, {N14998786754, Egalmeida@gmail.com}
SELECT * FROM clientes WHERE 'ge.santana@gmail.com' = ANY (chaves_pix);
Indices percorridos: 2 0 1
Indices percorridos: 6
44565434213, Geovana Santana, 25/10/1994, ge.santana@gmail.com, 16996543652, 0.00, {Ege.santana@gmail.com, C44565434213}

-- buscando por chaves PIX inexistentes
SELECT * FROM clientes WHERE '99282800581' = ANY (chaves_pix);
Indices percorridos: 5
ERRO: Registro nao encontrado
SELECT * FROM clientes WHERE '05780600923' = ANY (chaves_pix);
Indices percorridos: 1 0
ERRO: Registro nao encontrado
SELECT * FROM clientes WHERE '47691386772' = ANY (chaves_pix);
Indices percorridos: 1 0 1
ERRO: Registro nao encontrado
SELECT * FROM clientes WHERE '87906272920' = ANY (chaves_pix);
Indices percorridos: 1 0 1
ERRO: Registro nao encontrado

-- removendo chaves PIX

-- removendo chave PIX do começo de uma lista com mais de um elemento
UPDATE clientes SET chaves_pix = array_remove('A', chaves_pix) WHERE cpf = '66545678765';
OK

-- buscando por chave PIX removida
SELECT * FROM clientes WHERE '97301660-afcb-4ea4-a5a6-7c3abe8b8fbb' = ANY (chaves_pix);
Indices percorridos: 3 0
ERRO: Registro nao encontrado

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;mariaeugenia@gmail.com;15998765645;0000000000.00;C66545678765&N15998765645&Emariaeugenia@gmail.com;########################################################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;C99876556782&Ega.augusto@gmail.com;#######################################################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;Ege.santana@gmail.com&C44565434213;#######################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;N14998786754&Egalmeida@gmail.com;###########################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;Emelissa@gmail.com&A4064b4e3-53ac-4469-a819-708177365752&C14565436782;#######################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {4064b4e3-53ac-4469-a819-708177365752, 14565436782} {99876556782, 99876556782} {mariaeugenia@gmail.com, 66545678765}
[1] {14998786754, 54654367865} {66545678765, 66545678765}
[2] {44565434213, 44565434213} {ge.santana@gmail.com, 44565434213}
[3] {melissa@gmail.com, 14565436782}
[4] {15998765645, 66545678765} {galmeida@gmail.com, 54654367865}
[5]
[6] {14565436782, 14565436782} {ga.augusto@gmail.com, 99876556782}

-- removendo chave PIX do meio de uma lista com mais de um elemento
UPDATE clientes SET chaves_pix = array_remove('C', chaves_pix) WHERE cpf = '99876556782';
OK

-- buscando por chave PIX removida
SELECT * FROM clientes WHERE '99876556782' = ANY (chaves_pix);
Indices percorridos: 0 0 1
ERRO: Registro nao encontrado

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;mariaeugenia@gmail.com;15998765645;0000000000.00;C66545678765&N15998765645&Emariaeugenia@gmail.com;########################################################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;Ega.augusto@gmail.com;####################################################################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;Ege.santana@gmail.com&C44565434213;#######################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;N14998786754&Egalmeida@gmail.com;###########################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;Emelissa@gmail.com&A4064b4e3-53ac-4469-a819-708177365752&C14565436782;#######################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {4064b4e3-53ac-4469-a819-708177365752, 14565436782} {mariaeugenia@gmail.com, 66545678765}
[1] {14998786754, 54654367865} {66545678765, 66545678765}
[2] {44565434213, 44565434213} {ge.santana@gmail.com, 44565434213}
[3] {melissa@gmail.com, 14565436782}
[4] {15998765645, 66545678765} {galmeida@gmail.com, 54654367865}
[5]
[6] {14565436782, 14565436782} {ga.augusto@gmail.com, 99876556782}

-- removendo chave PIX do final de uma lista com mais de um elemento
UPDATE clientes SET chaves_pix = array_remove('E', chaves_pix) WHERE cpf = '44565434213';
OK

-- buscando por chave PIX removida
SELECT * FROM clientes WHERE 'ge.santana@gmail.com' = ANY (chaves_pix);
Indices percorridos: 2 0
ERRO: Registro nao encontrado

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;mariaeugenia@gmail.com;15998765645;0000000000.00;C66545678765&N15998765645&Emariaeugenia@gmail.com;########################################################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;Ega.augusto@gmail.com;####################################################################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;C44565434213;#############################################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;N14998786754&Egalmeida@gmail.com;###########################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;Emelissa@gmail.com&A4064b4e3-53ac-4469-a819-708177365752&C14565436782;#######################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {4064b4e3-53ac-4469-a819-708177365752, 14565436782} {mariaeugenia@gmail.com, 66545678765}
[1] {14998786754, 54654367865} {66545678765, 66545678765}
[2] {44565434213, 44565434213}
[3] {melissa@gmail.com, 14565436782}
[4] {15998765645, 66545678765} {galmeida@gmail.com, 54654367865}
[5]
[6] {14565436782, 14565436782} {ga.augusto@gmail.com, 99876556782}

-- removendo chave PIX de uma lista com apenas um elemento
UPDATE clientes SET chaves_pix = array_remove('E', chaves_pix) WHERE cpf = '14565436782';
OK

-- buscando por chave PIX removida
SELECT * FROM clientes WHERE 'melissa@gmail.com' = ANY (chaves_pix);
Indices percorridos: 3
ERRO: Registro nao encontrado

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;mariaeugenia@gmail.com;15998765645;0000000000.00;C66545678765&N15998765645&Emariaeugenia@gmail.com;########################################################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;Ega.augusto@gmail.com;####################################################################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;C44565434213;#############################################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;N14998786754&Egalmeida@gmail.com;###########################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;A4064b4e3-53ac-4469-a819-708177365752&C14565436782;##########################################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {4064b4e3-53ac-4469-a819-708177365752, 14565436782} {mariaeugenia@gmail.com, 66545678765}
[1] {14998786754, 54654367865} {66545678765, 66545678765}
[2] {44565434213, 44565434213}
[3]
[4] {15998765645, 66545678765} {galmeida@gmail.com, 54654367865}
[5]
[6] {14565436782, 14565436782} {ga.augusto@gmail.com, 99876556782}

-- removendo chave PIX do começo de uma lista com mais de um elemento
UPDATE clientes SET chaves_pix = array_remove('N', chaves_pix) WHERE cpf = '54654367865';
OK

-- buscando por chave PIX removida
SELECT * FROM clientes WHERE '14998786754' = ANY (chaves_pix);
Indices percorridos: 1 0
ERRO: Registro nao encontrado

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;mariaeugenia@gmail.com;15998765645;0000000000.00;C66545678765&N15998765645&Emariaeugenia@gmail.com;########################################################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;Ega.augusto@gmail.com;####################################################################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;C44565434213;#############################################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;Egalmeida@gmail.com;########################################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;A4064b4e3-53ac-4469-a819-708177365752&C14565436782;##########################################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {4064b4e3-53ac-4469-a819-708177365752, 14565436782} {mariaeugenia@gmail.com, 66545678765}
[1] {66545678765, 66545678765}
[2] {44565434213, 44565434213}
[3]
[4] {15998765645, 66545678765} {galmeida@gmail.com, 54654367865}
[5]
[6] {14565436782, 14565436782} {ga.augusto@gmail.com, 99876556782}

-- buscando por chaves PIX cadastradas
SELECT * FROM clientes WHERE 'ga.augusto@gmail.com' = ANY (chaves_pix);
Indices percorridos: 6 0 1
Indices percorridos: 5
99876556782, Gabriel Augusto, 04/05/1997, ga.augusto@gmail.com, 15997675654, 0.00, {Ega.augusto@gmail.com}
SELECT * FROM clientes WHERE '44565434213' = ANY (chaves_pix);
Indices percorridos: 2 0
Indices percorridos: 6
44565434213, Geovana Santana, 25/10/1994, ge.santana@gmail.com, 16996543652, 0.00, {C44565434213}
SELECT * FROM clientes WHERE 'mariaeugenia@gmail.com' = ANY (chaves_pix);
Indices percorridos: 0 0 1
Indices percorridos: 9
66545678765, Maria Eugenia, 12/04/1980, mariaeugenia@gmail.com, 15998765645, 0.00, {C66545678765, N15998765645, Emariaeugenia@gmail.com}
SELECT * FROM clientes WHERE '4064b4e3-53ac-4469-a819-708177365752' = ANY (chaves_pix);
Indices percorridos: 0 0
Indices percorridos: 9 10
14565436782, Melissa Pereira, 19/09/1993, melissa@gmail.com, 15997654738, 0.00, {A4064b4e3-53ac-4469-a819-708177365752, C14565436782}
SELECT * FROM clientes WHERE 'galmeida@gmail.com' = ANY (chaves_pix);
Indices percorridos: 4 0 1
Indices percorridos: 1
54654367865, Gustavo Almeida, 19/11/1992, galmeida@gmail.com, 14998786754, 0.00, {Egalmeida@gmail.com}

-- recadastrando chaves PIX

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'A') WHERE cpf = '66545678765';
OK

-- buscando por chave PIX recém cadastrada
SELECT * FROM clientes WHERE 'abc80d38-ac29-48ab-9743-764d68b28493' = ANY (chaves_pix);
Indices percorridos: 1 0 1
Indices percorridos: 9
66545678765, Maria Eugenia, 12/04/1980, mariaeugenia@gmail.com, 15998765645, 0.00, {C66545678765, N15998765645, Emariaeugenia@gmail.com, Aabc80d38-ac29-48ab-9743-764d68b28493}

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;mariaeugenia@gmail.com;15998765645;0000000000.00;C66545678765&N15998765645&Emariaeugenia@gmail.com&Aabc80d38-ac29-48ab-9743-764d68b28493;##################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;Ega.augusto@gmail.com;####################################################################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;C44565434213;#############################################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;Egalmeida@gmail.com;########################################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;A4064b4e3-53ac-4469-a819-708177365752&C14565436782;##########################################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {4064b4e3-53ac-4469-a819-708177365752, 14565436782} {mariaeugenia@gmail.com, 66545678765}
[1] {66545678765, 66545678765} {abc80d38-ac29-48ab-9743-764d68b28493, 66545678765}
[2] {44565434213, 44565434213}
[3]
[4] {15998765645, 66545678765} {galmeida@gmail.com, 54654367865}
[5]
[6] {14565436782, 14565436782} {ga.augusto@gmail.com, 99876556782}

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'C') WHERE cpf = '99876556782';
OK

-- buscando por chave PIX recém cadastrada
SELECT * FROM clientes WHERE '99876556782' = ANY (chaves_pix);
Indices percorridos: 11 0
Indices percorridos: 5
99876556782, Gabriel Augusto, 04/05/1997, ga.augusto@gmail.com, 15997675654, 0.00, {Ega.augusto@gmail.com, C99876556782}

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;mariaeugenia@gmail.com;15998765645;0000000000.00;C66545678765&N15998765645&Emariaeugenia@gmail.com&Aabc80d38-ac29-48ab-9743-764d68b28493;##################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;Ega.augusto@gmail.com&C99876556782;#######################################################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;C44565434213;#############################################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;Egalmeida@gmail.com;########################################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;A4064b4e3-53ac-4469-a819-708177365752&C14565436782;##########################################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {mariaeugenia@gmail.com, 66545678765}
[1]
[2]
[3]
[4]
[5] {14565436782, 14565436782} {44565434213, 44565434213}
[6] {15998765645, 66545678765} {4064b4e3-53ac-4469-a819-708177365752, 14565436782}
[7]
[8] {galmeida@gmail.com, 54654367865}
[9]
[10] {abc80d38-ac29-48ab-9743-764d68b28493, 66545678765}
[11] {99876556782, 99876556782}
[12]
[13]
[14] {ga.augusto@gmail.com, 99876556782}
[15]
[16] {66545678765, 66545678765}

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'E') WHERE cpf = '44565434213';
OK

-- buscando por chave PIX recém cadastrada
SELECT * FROM clientes WHERE 'ge.santana@gmail.com' = ANY (chaves_pix);
Indices percorridos: 0 0
Indices percorridos: 6
44565434213, Geovana Santana, 25/10/1994, ge.santana@gmail.com, 16996543652, 0.00, {C44565434213, Ege.santana@gmail.com}

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;mariaeugenia@gmail.com;15998765645;0000000000.00;C66545678765&N15998765645&Emariaeugenia@gmail.com&Aabc80d38-ac29-48ab-9743-764d68b28493;##################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;Ega.augusto@gmail.com&C99876556782;#######################################################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;C44565434213&Ege.santana@gmail.com;#######################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;Egalmeida@gmail.com;########################################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;A4064b4e3-53ac-4469-a819-708177365752&C14565436782;##########################################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {ge.santana@gmail.com, 44565434213} {mariaeugenia@gmail.com, 66545678765}
[1]
[2]
[3]
[4]
[5] {14565436782, 14565436782} {44565434213, 44565434213}
[6] {15998765645, 66545678765} {4064b4e3-53ac-4469-a819-708177365752, 14565436782}
[7]
[8] {galmeida@gmail.com, 54654367865}
[9]
[10] {abc80d38-ac29-48ab-9743-764d68b28493, 66545678765}
[11] {99876556782, 99876556782}
[12]
[13]
[14] {ga.augusto@gmail.com, 99876556782}
[15]
[16] {66545678765, 66545678765}

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'E') WHERE cpf = '14565436782';
OK

-- buscando por chave PIX recém cadastrada
SELECT * FROM clientes WHERE 'melissa@gmail.com' = ANY (chaves_pix);
Indices percorridos: 3 0
Indices percorridos: 9 10
14565436782, Melissa Pereira, 19/09/1993, melissa@gmail.com, 15997654738, 0.00, {A4064b4e3-53ac-4469-a819-708177365752, C14565436782, Emelissa@gmail.com}

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;mariaeugenia@gmail.com;15998765645;0000000000.00;C66545678765&N15998765645&Emariaeugenia@gmail.com&Aabc80d38-ac29-48ab-9743-764d68b28493;##################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;Ega.augusto@gmail.com&C99876556782;#######################################################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;C44565434213&Ege.santana@gmail.com;#######################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;Egalmeida@gmail.com;########################################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;A4064b4e3-53ac-4469-a819-708177365752&C14565436782&Emelissa@gmail.com;#######################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {ge.santana@gmail.com, 44565434213} {mariaeugenia@gmail.com, 66545678765}
[1]
[2]
[3] {melissa@gmail.com, 14565436782}
[4]
[5] {14565436782, 14565436782} {44565434213, 44565434213}
[6] {15998765645, 66545678765} {4064b4e3-53ac-4469-a819-708177365752, 14565436782}
[7]
[8] {galmeida@gmail.com, 54654367865}
[9]
[10] {abc80d38-ac29-48ab-9743-764d68b28493, 66545678765}
[11] {99876556782, 99876556782}
[12]
[13]
[14] {ga.augusto@gmail.com, 99876556782}
[15]
[16] {66545678765, 66545678765}

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'N') WHERE cpf = '54654367865';
OK

-- buscando por chave PIX recém cadastrada
SELECT * FROM clientes WHERE '14998786754' = ANY (chaves_pix);
Indices percorridos: 7 0
Indices percorridos: 1
54654367865, Gustavo Almeida, 19/11/1992, galmeida@gmail.com, 14998786754, 0.00, {Egalmeida@gmail.com, N14998786754}

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;mariaeugenia@gmail.com;15998765645;0000000000.00;C66545678765&N15998765645&Emariaeugenia@gmail.com&Aabc80d38-ac29-48ab-9743-764d68b28493;##################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;Ega.augusto@gmail.com&C99876556782;#######################################################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;C44565434213&Ege.santana@gmail.com;#######################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;Egalmeida@gmail.com&N14998786754;###########################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;A4064b4e3-53ac-4469-a819-708177365752&C14565436782&Emelissa@gmail.com;#######################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {ge.santana@gmail.com, 44565434213} {mariaeugenia@gmail.com, 66545678765}
[1]
[2]
[3] {melissa@gmail.com, 14565436782}
[4]
[5] {14565436782, 14565436782} {44565434213, 44565434213}
[6] {15998765645, 66545678765} {4064b4e3-53ac-4469-a819-708177365752, 14565436782}
[7] {14998786754, 54654367865}
[8] {galmeida@gmail.com, 54654367865}
[9]
[10] {abc80d38-ac29-48ab-9743-764d68b28493, 66545678765}
[11] {99876556782, 99876556782}
[12]
[13]
[14] {ga.augusto@gmail.com, 99876556782}
[15]
[16] {66545678765, 66545678765}

-- buscando por chaves PIX cadastradas
SELECT * FROM clientes WHERE 'ga.augusto@gmail.com' = ANY (chaves_pix);
Indices percorridos: 14 0
Indices percorridos: 5
99876556782, Gabriel Augusto, 04/05/1997, ga.augusto@gmail.com, 15997675654, 0.00, {Ega.augusto@gmail.com, C99876556782}
SELECT * FROM clientes WHERE '44565434213' = ANY (chaves_pix);
Indices percorridos: 5 0 1
Indices percorridos: 6
44565434213, Geovana Santana, 25/10/1994, ge.santana@gmail.com, 16996543652, 0.00, {C44565434213, Ege.santana@gmail.com}
SELECT * FROM clientes WHERE 'mariaeugenia@gmail.com' = ANY (chaves_pix);
Indices percorridos: 0 0 1
Indices percorridos: 9
66545678765, Maria Eugenia, 12/04/1980, mariaeugenia@gmail.com, 15998765645, 0.00, {C66545678765, N15998765645, Emariaeugenia@gmail.com, Aabc80d38-ac29-48ab-9743-764d68b28493}
SELECT * FROM clientes WHERE '4064b4e3-53ac-4469-a819-708177365752' = ANY (chaves_pix);
Indices percorridos: 6 0 1
Indices percorridos: 9 10
14565436782, Melissa Pereira, 19/09/1993, melissa@gmail.com, 15997654738, 0.00, {A4064b4e3-53ac-4469-a819-708177365752, C14565436782, Emelissa@gmail.com}
SELECT * FROM clientes WHERE 'galmeida@gmail.com' = ANY (chaves_pix);
Indices percorridos: 8 0
Indices percorridos: 1
54654367865, Gustavo Almeida, 19/11/1992, galmeida@gmail.com, 14998786754, 0.00, {Egalmeida@gmail.com, N14998786754}

-- chave PIX já cadastrada por outro usuário
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'E') WHERE cpf = '37567876542';
ERRO: Ja existe uma chave PIX melissa@gmail.com

-- chave PIX já cadastrada por outro usuário
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'N') WHERE cpf = '23465784759';
ERRO: Ja existe uma chave PIX 14998786754

-- tentando cadastrar chaves PIX duplicadas
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'C') WHERE cpf = '66545678765';
ERRO: Chave PIX tipo C ja cadastrada para este usuario
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'N') WHERE cpf = '66545678765';
ERRO: Chave PIX tipo N ja cadastrada para este usuario
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'E') WHERE cpf = '99876556782';
ERRO: Chave PIX tipo E ja cadastrada para este usuario
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'C') WHERE cpf = '44565434213';
ERRO: Chave PIX tipo C ja cadastrada para este usuario
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'C') WHERE cpf = '14565436782';
ERRO: Chave PIX tipo C ja cadastrada para este usuario
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'E') WHERE cpf = '54654367865';
ERRO: Chave PIX tipo E ja cadastrada para este usuario
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'E') WHERE cpf = '66545678765';
ERRO: Chave PIX tipo E ja cadastrada para este usuario

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;mariaeugenia@gmail.com;15998765645;0000000000.00;C66545678765&N15998765645&Emariaeugenia@gmail.com&Aabc80d38-ac29-48ab-9743-764d68b28493;##################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;Ega.augusto@gmail.com&C99876556782;#######################################################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;C44565434213&Ege.santana@gmail.com;#######################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;Egalmeida@gmail.com&N14998786754;###########################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;A4064b4e3-53ac-4469-a819-708177365752&C14565436782&Emelissa@gmail.com;#######################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {ge.santana@gmail.com, 44565434213} {mariaeugenia@gmail.com, 66545678765}
[1]
[2]
[3] {melissa@gmail.com, 14565436782}
[4]
[5] {14565436782, 14565436782} {44565434213, 44565434213}
[6] {15998765645, 66545678765} {4064b4e3-53ac-4469-a819-708177365752, 14565436782}
[7] {14998786754, 54654367865}
[8] {galmeida@gmail.com, 54654367865}
[9]
[10] {abc80d38-ac29-48ab-9743-764d68b28493, 66545678765}
[11] {99876556782, 99876556782}
[12]
[13]
[14] {ga.augusto@gmail.com, 99876556782}
[15]
[16] {66545678765, 66545678765}

-- cadastrando chaves PIX para os usuários

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'A') WHERE cpf = '99876556782';
OK

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;mariaeugenia@gmail.com;15998765645;0000000000.00;C66545678765&N15998765645&Emariaeugenia@gmail.com&Aabc80d38-ac29-48ab-9743-764d68b28493;##################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;Ega.augusto@gmail.com&C99876556782&Ac6c10fd9-9fd3-447a-95bb-386215dceda1;#################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;C44565434213&Ege.santana@gmail.com;#######################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;Egalmeida@gmail.com&N14998786754;###########################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;A4064b4e3-53ac-4469-a819-708177365752&C14565436782&Emelissa@gmail.com;#######################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {ge.santana@gmail.com, 44565434213} {mariaeugenia@gmail.com, 66545678765}
[1]
[2]
[3] {c6c10fd9-9fd3-447a-95bb-386215dceda1, 99876556782} {melissa@gmail.com, 14565436782}
[4]
[5] {14565436782, 14565436782} {44565434213, 44565434213}
[6] {15998765645, 66545678765} {4064b4e3-53ac-4469-a819-708177365752, 14565436782}
[7] {14998786754, 54654367865}
[8] {galmeida@gmail.com, 54654367865}
[9]
[10] {abc80d38-ac29-48ab-9743-764d68b28493, 66545678765}
[11] {99876556782, 99876556782}
[12]
[13]
[14] {ga.augusto@gmail.com, 99876556782}
[15]
[16] {66545678765, 66545678765}

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'N') WHERE cpf = '99876556782';
OK

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;mariaeugenia@gmail.com;15998765645;0000000000.00;C66545678765&N15998765645&Emariaeugenia@gmail.com&Aabc80d38-ac29-48ab-9743-764d68b28493;##################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;Ega.augusto@gmail.com&C99876556782&Ac6c10fd9-9fd3-447a-95bb-386215dceda1&N15997675654;####################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;C44565434213&Ege.santana@gmail.com;#######################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;Egalmeida@gmail.com&N14998786754;###########################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;A4064b4e3-53ac-4469-a819-708177365752&C14565436782&Emelissa@gmail.com;#######################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {ge.santana@gmail.com, 44565434213} {mariaeugenia@gmail.com, 66545678765}
[1]
[2]
[3] {c6c10fd9-9fd3-447a-95bb-386215dceda1, 99876556782} {melissa@gmail.com, 14565436782}
[4]
[5] {14565436782, 14565436782} {44565434213, 44565434213}
[6] {15998765645, 66545678765} {4064b4e3-53ac-4469-a819-708177365752, 14565436782}
[7] {14998786754, 54654367865}
[8] {galmeida@gmail.com, 54654367865}
[9]
[10] {abc80d38-ac29-48ab-9743-764d68b28493, 66545678765}
[11] {99876556782, 99876556782}
[12]
[13]
[14] {15997675654, 99876556782} {ga.augusto@gmail.com, 99876556782}
[15]
[16] {66545678765, 66545678765}

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'A') WHERE cpf = '44565434213';
OK

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;mariaeugenia@gmail.com;15998765645;0000000000.00;C66545678765&N15998765645&Emariaeugenia@gmail.com&Aabc80d38-ac29-48ab-9743-764d68b28493;##################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;Ega.augusto@gmail.com&C99876556782&Ac6c10fd9-9fd3-447a-95bb-386215dceda1&N15997675654;####################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;C44565434213&Ege.santana@gmail.com&Ae5ba952e-f48d-48fd-a9ff-2818edd11c28;#################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;Egalmeida@gmail.com&N14998786754;###########################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;A4064b4e3-53ac-4469-a819-708177365752&C14565436782&Emelissa@gmail.com;#######################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {ge.santana@gmail.com, 44565434213} {mariaeugenia@gmail.com, 66545678765}
[1]
[2]
[3] {c6c10fd9-9fd3-447a-95bb-386215dceda1, 99876556782} {melissa@gmail.com, 14565436782}
[4]
[5] {14565436782, 14565436782} {44565434213, 44565434213}
[6] {15998765645, 66545678765} {4064b4e3-53ac-4469-a819-708177365752, 14565436782}
[7] {14998786754, 54654367865}
[8] {galmeida@gmail.com, 54654367865}
[9]
[10] {abc80d38-ac29-48ab-9743-764d68b28493, 66545678765}
[11] {99876556782, 99876556782}
[12] {e5ba952e-f48d-48fd-a9ff-2818edd11c28, 44565434213}
[13]
[14] {15997675654, 99876556782} {ga.augusto@gmail.com, 99876556782}
[15]
[16] {66545678765, 66545678765}

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'N') WHERE cpf = '44565434213';
OK

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;mariaeugenia@gmail.com;15998765645;0000000000.00;C66545678765&N15998765645&Emariaeugenia@gmail.com&Aabc80d38-ac29-48ab-9743-764d68b28493;##################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;Ega.augusto@gmail.com&C99876556782&Ac6c10fd9-9fd3-447a-95bb-386215dceda1&N15997675654;####################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;C44565434213&Ege.santana@gmail.com&Ae5ba952e-f48d-48fd-a9ff-2818edd11c28&N16996543652;####################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;Egalmeida@gmail.com&N14998786754;###########################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;A4064b4e3-53ac-4469-a819-708177365752&C14565436782&Emelissa@gmail.com;#######################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {ge.santana@gmail.com, 44565434213} {mariaeugenia@gmail.com, 66545678765}
[1]
[2]
[3] {c6c10fd9-9fd3-447a-95bb-386215dceda1, 99876556782} {melissa@gmail.com, 14565436782}
[4]
[5] {14565436782, 14565436782} {16996543652, 44565434213} {44565434213, 44565434213}
[6] {15998765645, 66545678765} {4064b4e3-53ac-4469-a819-708177365752, 14565436782}
[7] {14998786754, 54654367865}
[8] {galmeida@gmail.com, 54654367865}
[9]
[10] {abc80d38-ac29-48ab-9743-764d68b28493, 66545678765}
[11] {99876556782, 99876556782}
[12] {e5ba952e-f48d-48fd-a9ff-2818edd11c28, 44565434213}
[13]
[14] {15997675654, 99876556782} {ga.augusto@gmail.com, 99876556782}
[15]
[16] {66545678765, 66545678765}

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'N') WHERE cpf = '14565436782';
OK

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;mariaeugenia@gmail.com;15998765645;0000000000.00;C66545678765&N15998765645&Emariaeugenia@gmail.com&Aabc80d38-ac29-48ab-9743-764d68b28493;##################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;Ega.augusto@gmail.com&C99876556782&Ac6c10fd9-9fd3-447a-95bb-386215dceda1&N15997675654;####################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;C44565434213&Ege.santana@gmail.com&Ae5ba952e-f48d-48fd-a9ff-2818edd11c28&N16996543652;####################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;Egalmeida@gmail.com&N14998786754;###########################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;A4064b4e3-53ac-4469-a819-708177365752&C14565436782&Emelissa@gmail.com&N15997654738;##########################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {15997654738, 14565436782} {ge.santana@gmail.com, 44565434213} {mariaeugenia@gmail.com, 66545678765}
[1]
[2]
[3] {c6c10fd9-9fd3-447a-95bb-386215dceda1, 99876556782} {melissa@gmail.com, 14565436782}
[4]
[5] {14565436782, 14565436782} {16996543652, 44565434213} {44565434213, 44565434213}
[6] {15998765645, 66545678765} {4064b4e3-53ac-4469-a819-708177365752, 14565436782}
[7] {14998786754, 54654367865}
[8] {galmeida@gmail.com, 54654367865}
[9]
[10] {abc80d38-ac29-48ab-9743-764d68b28493, 66545678765}
[11] {99876556782, 99876556782}
[12] {e5ba952e-f48d-48fd-a9ff-2818edd11c28, 44565434213}
[13]
[14] {15997675654, 99876556782} {ga.augusto@gmail.com, 99876556782}
[15]
[16] {66545678765, 66545678765}

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'A') WHERE cpf = '54654367865';
OK

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;mariaeugenia@gmail.com;15998765645;0000000000.00;C66545678765&N15998765645&Emariaeugenia@gmail.com&Aabc80d38-ac29-48ab-9743-764d68b28493;##################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;Ega.augusto@gmail.com&C99876556782&Ac6c10fd9-9fd3-447a-95bb-386215dceda1&N15997675654;####################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;C44565434213&Ege.santana@gmail.com&Ae5ba952e-f48d-48fd-a9ff-2818edd11c28&N16996543652;####################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;Egalmeida@gmail.com&N14998786754&Ae543bbeb-b8c9-4d7f-beef-81899b79cea2;#####################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;A4064b4e3-53ac-4469-a819-708177365752&C14565436782&Emelissa@gmail.com&N15997654738;##########################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {15997654738, 14565436782} {ge.santana@gmail.com, 44565434213} {mariaeugenia@gmail.com, 66545678765}
[1]
[2]
[3] {c6c10fd9-9fd3-447a-95bb-386215dceda1, 99876556782} {melissa@gmail.com, 14565436782}
[4]
[5] {14565436782, 14565436782} {16996543652, 44565434213} {44565434213, 44565434213} {e543bbeb-b8c9-4d7f-beef-81899b79cea2, 54654367865}
[6] {15998765645, 66545678765} {4064b4e3-53ac-4469-a819-708177365752, 14565436782}
[7] {14998786754, 54654367865}
[8] {galmeida@gmail.com, 54654367865}
[9]
[10] {abc80d38-ac29-48ab-9743-764d68b28493, 66545678765}
[11] {99876556782, 99876556782}
[12] {e5ba952e-f48d-48fd-a9ff-2818edd11c28, 44565434213}
[13]
[14] {15997675654, 99876556782} {ga.augusto@gmail.com, 99876556782}
[15]
[16] {66545678765, 66545678765}

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'C') WHERE cpf = '54654367865';
OK

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;mariaeugenia@gmail.com;15998765645;0000000000.00;C66545678765&N15998765645&Emariaeugenia@gmail.com&Aabc80d38-ac29-48ab-9743-764d68b28493;##################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;Ega.augusto@gmail.com&C99876556782&Ac6c10fd9-9fd3-447a-95bb-386215dceda1&N15997675654;####################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;C44565434213&Ege.santana@gmail.com&Ae5ba952e-f48d-48fd-a9ff-2818edd11c28&N16996543652;####################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;Egalmeida@gmail.com&N14998786754&Ae543bbeb-b8c9-4d7f-beef-81899b79cea2&C54654367865;########################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;A4064b4e3-53ac-4469-a819-708177365752&C14565436782&Emelissa@gmail.com&N15997654738;##########################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {15997654738, 14565436782} {ge.santana@gmail.com, 44565434213} {mariaeugenia@gmail.com, 66545678765}
[1]
[2]
[3] {54654367865, 54654367865} {c6c10fd9-9fd3-447a-95bb-386215dceda1, 99876556782} {melissa@gmail.com, 14565436782}
[4]
[5] {14565436782, 14565436782} {16996543652, 44565434213} {44565434213, 44565434213} {e543bbeb-b8c9-4d7f-beef-81899b79cea2, 54654367865}
[6] {15998765645, 66545678765} {4064b4e3-53ac-4469-a819-708177365752, 14565436782}
[7] {14998786754, 54654367865}
[8] {galmeida@gmail.com, 54654367865}
[9]
[10] {abc80d38-ac29-48ab-9743-764d68b28493, 66545678765}
[11] {99876556782, 99876556782}
[12] {e5ba952e-f48d-48fd-a9ff-2818edd11c28, 44565434213}
[13]
[14] {15997675654, 99876556782} {ga.augusto@gmail.com, 99876556782}
[15]
[16] {66545678765, 66545678765}

-- buscando clientes por chaves PIX inexistentes ou não cadastradas
SELECT * FROM clientes WHERE '6bbc4c97-55b7-48fa-9e43-b53d5ad37f8d' = ANY (chaves_pix);
Indices percorridos: 5 0 1 2 3
ERRO: Registro nao encontrado
SELECT * FROM clientes WHERE 'josesantos@gmail.com' = ANY (chaves_pix);
Indices percorridos: 9
ERRO: Registro nao encontrado
SELECT * FROM clientes WHERE '15998765435' = ANY (chaves_pix);
Indices percorridos: 10 0
ERRO: Registro nao encontrado
SELECT * FROM clientes WHERE '54654360578' = ANY (chaves_pix);
Indices percorridos: 8 0
ERRO: Registro nao encontrado
SELECT * FROM clientes WHERE '31997675654' = ANY (chaves_pix);
Indices percorridos: 16 0
ERRO: Registro nao encontrado

\q
