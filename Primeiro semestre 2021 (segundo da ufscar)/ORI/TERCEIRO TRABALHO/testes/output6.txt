-- OPERAÇÕES CONTEMPLADAS PELO CASO DE TESTE:
-- (COM ARQUIVO DE CLIENTES)
-- CADASTRO DE CHAVE PIX
-- IMPRIMIR ARQUIVO DE CLIENTES
-- IMPRIMIR ÍNDICE DE CLIENTES
-- IMPRIMIR ÍNDICE DE CHAVES PIX

-- AO RECEBER O ARQUIVO DE DADOS, A FUNÇÃO criar_chaves_pix_idx
-- CAUSA UM REDIMENSIONAMENTO, QUE POR SUA VEZ, CHAMA NOVAMENTE
-- criar_chaves_pix_idx, O QUE PRODUZ ERROS.
-- RESOLVA ESSE PROBLEMA COM AS DICAS NOS COMENTÁRIOS.

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;maria.eu9@gmail.com;15998765645;0000000000.00;A94a9eddc-31dd-4857-a357-0e5d46c490db;#######################################################################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;C99876556782;#############################################################################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;Ege.santana@gmail.com;####################################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;N14998786754;###############################################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;Emelissa@gmail.com;##########################################################################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {94a9eddc-31dd-4857-a357-0e5d46c490db, 66545678765}
[1] {99876556782, 99876556782} {melissa@gmail.com, 14565436782}
[2] {14998786754, 54654367865} {ge.santana@gmail.com, 44565434213}

-- tentando cadastrar chaves PIX duplicadas
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'A') WHERE cpf = '66545678765';
ERRO: Chave PIX tipo A ja cadastrada para este usuario
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'C') WHERE cpf = '99876556782';
ERRO: Chave PIX tipo C ja cadastrada para este usuario
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'E') WHERE cpf = '44565434213';
ERRO: Chave PIX tipo E ja cadastrada para este usuario
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'E') WHERE cpf = '14565436782';
ERRO: Chave PIX tipo E ja cadastrada para este usuario
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'N') WHERE cpf = '54654367865';
ERRO: Chave PIX tipo N ja cadastrada para este usuario

-- chave PIX já cadastrada por outro usuário
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'E') WHERE cpf = '37567876542';
ERRO: Ja existe uma chave PIX melissa@gmail.com
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'N') WHERE cpf = '23465784759';
ERRO: Ja existe uma chave PIX 14998786754

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;maria.eu9@gmail.com;15998765645;0000000000.00;A94a9eddc-31dd-4857-a357-0e5d46c490db;#######################################################################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;C99876556782;#############################################################################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;Ege.santana@gmail.com;####################################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;N14998786754;###############################################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;Emelissa@gmail.com;##########################################################################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {94a9eddc-31dd-4857-a357-0e5d46c490db, 66545678765}
[1] {99876556782, 99876556782} {melissa@gmail.com, 14565436782}
[2] {14998786754, 54654367865} {ge.santana@gmail.com, 44565434213}

-- cadastrando novas chaves PIX para os usuários
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'C') WHERE cpf = '66545678765';
OK

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;maria.eu9@gmail.com;15998765645;0000000000.00;A94a9eddc-31dd-4857-a357-0e5d46c490db&C66545678765;##########################################################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;C99876556782;#############################################################################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;Ege.santana@gmail.com;####################################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;N14998786754;###############################################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;Emelissa@gmail.com;##########################################################################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {94a9eddc-31dd-4857-a357-0e5d46c490db, 66545678765}
[1] {99876556782, 99876556782} {melissa@gmail.com, 14565436782}
[2] {14998786754, 54654367865} {66545678765, 66545678765} {ge.santana@gmail.com, 44565434213}

-- inserção que causa o redimensionamento da tabela hash
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'N') WHERE cpf = '66545678765';
OK

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;maria.eu9@gmail.com;15998765645;0000000000.00;A94a9eddc-31dd-4857-a357-0e5d46c490db&C66545678765&N15998765645;#############################################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;C99876556782;#############################################################################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;Ege.santana@gmail.com;####################################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;N14998786754;###############################################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;Emelissa@gmail.com;##########################################################################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {99876556782, 99876556782}
[1] {14998786754, 54654367865} {66545678765, 66545678765}
[2] {ge.santana@gmail.com, 44565434213}
[3] {melissa@gmail.com, 14565436782}
[4] {15998765645, 66545678765} {94a9eddc-31dd-4857-a357-0e5d46c490db, 66545678765}
[5]
[6]

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'E') WHERE cpf = '99876556782';
OK

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;maria.eu9@gmail.com;15998765645;0000000000.00;A94a9eddc-31dd-4857-a357-0e5d46c490db&C66545678765&N15998765645;#############################################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;C99876556782&Ega.augusto@gmail.com;#######################################################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;Ege.santana@gmail.com;####################################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;N14998786754;###############################################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;Emelissa@gmail.com;##########################################################################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {99876556782, 99876556782}
[1] {14998786754, 54654367865} {66545678765, 66545678765}
[2] {ge.santana@gmail.com, 44565434213}
[3] {melissa@gmail.com, 14565436782}
[4] {15998765645, 66545678765} {94a9eddc-31dd-4857-a357-0e5d46c490db, 66545678765}
[5]
[6] {ga.augusto@gmail.com, 99876556782}

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'C') WHERE cpf = '44565434213';
OK

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;maria.eu9@gmail.com;15998765645;0000000000.00;A94a9eddc-31dd-4857-a357-0e5d46c490db&C66545678765&N15998765645;#############################################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;C99876556782&Ega.augusto@gmail.com;#######################################################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;Ege.santana@gmail.com&C44565434213;#######################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;N14998786754;###############################################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;Emelissa@gmail.com;##########################################################################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {99876556782, 99876556782}
[1] {14998786754, 54654367865} {66545678765, 66545678765}
[2] {44565434213, 44565434213} {ge.santana@gmail.com, 44565434213}
[3] {melissa@gmail.com, 14565436782}
[4] {15998765645, 66545678765} {94a9eddc-31dd-4857-a357-0e5d46c490db, 66545678765}
[5]
[6] {ga.augusto@gmail.com, 99876556782}

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'C') WHERE cpf = '14565436782';
OK

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;maria.eu9@gmail.com;15998765645;0000000000.00;A94a9eddc-31dd-4857-a357-0e5d46c490db&C66545678765&N15998765645;#############################################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;C99876556782&Ega.augusto@gmail.com;#######################################################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;Ege.santana@gmail.com&C44565434213;#######################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;N14998786754;###############################################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;Emelissa@gmail.com&C14565436782;#############################################################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {99876556782, 99876556782}
[1] {14998786754, 54654367865} {66545678765, 66545678765}
[2] {44565434213, 44565434213} {ge.santana@gmail.com, 44565434213}
[3] {melissa@gmail.com, 14565436782}
[4] {15998765645, 66545678765} {94a9eddc-31dd-4857-a357-0e5d46c490db, 66545678765}
[5]
[6] {14565436782, 14565436782} {ga.augusto@gmail.com, 99876556782}

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'E') WHERE cpf = '54654367865';
OK

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;maria.eu9@gmail.com;15998765645;0000000000.00;A94a9eddc-31dd-4857-a357-0e5d46c490db&C66545678765&N15998765645;#############################################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;C99876556782&Ega.augusto@gmail.com;#######################################################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;Ege.santana@gmail.com&C44565434213;#######################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;N14998786754&Egalmeida@gmail.com;###########################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;Emelissa@gmail.com&C14565436782;#############################################################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {99876556782, 99876556782}
[1] {14998786754, 54654367865} {66545678765, 66545678765}
[2] {44565434213, 44565434213} {ge.santana@gmail.com, 44565434213}
[3] {melissa@gmail.com, 14565436782}
[4] {15998765645, 66545678765} {94a9eddc-31dd-4857-a357-0e5d46c490db, 66545678765} {galmeida@gmail.com, 54654367865}
[5]
[6] {14565436782, 14565436782} {ga.augusto@gmail.com, 99876556782}

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'E') WHERE cpf = '66545678765';
OK

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;maria.eu9@gmail.com;15998765645;0000000000.00;A94a9eddc-31dd-4857-a357-0e5d46c490db&C66545678765&N15998765645&Emaria.eu9@gmail.com;########################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;C99876556782&Ega.augusto@gmail.com;#######################################################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;Ege.santana@gmail.com&C44565434213;#######################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;N14998786754&Egalmeida@gmail.com;###########################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;Emelissa@gmail.com&C14565436782;#############################################################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {99876556782, 99876556782} {maria.eu9@gmail.com, 66545678765}
[1] {14998786754, 54654367865} {66545678765, 66545678765}
[2] {44565434213, 44565434213} {ge.santana@gmail.com, 44565434213}
[3] {melissa@gmail.com, 14565436782}
[4] {15998765645, 66545678765} {94a9eddc-31dd-4857-a357-0e5d46c490db, 66545678765} {galmeida@gmail.com, 54654367865}
[5]
[6] {14565436782, 14565436782} {ga.augusto@gmail.com, 99876556782}

-- mais inserções

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'A') WHERE cpf = '99876556782';
OK

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;maria.eu9@gmail.com;15998765645;0000000000.00;A94a9eddc-31dd-4857-a357-0e5d46c490db&C66545678765&N15998765645&Emaria.eu9@gmail.com;########################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;C99876556782&Ega.augusto@gmail.com&A9bf4efaf-75ea-48d6-8e2b-0f76813e60ef;#################################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;Ege.santana@gmail.com&C44565434213;#######################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;N14998786754&Egalmeida@gmail.com;###########################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;Emelissa@gmail.com&C14565436782;#############################################################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {99876556782, 99876556782} {maria.eu9@gmail.com, 66545678765}
[1] {14998786754, 54654367865} {66545678765, 66545678765}
[2] {44565434213, 44565434213} {ge.santana@gmail.com, 44565434213}
[3] {melissa@gmail.com, 14565436782}
[4] {15998765645, 66545678765} {94a9eddc-31dd-4857-a357-0e5d46c490db, 66545678765} {galmeida@gmail.com, 54654367865}
[5] {9bf4efaf-75ea-48d6-8e2b-0f76813e60ef, 99876556782}
[6] {14565436782, 14565436782} {ga.augusto@gmail.com, 99876556782}

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'N') WHERE cpf = '99876556782';
OK

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;maria.eu9@gmail.com;15998765645;0000000000.00;A94a9eddc-31dd-4857-a357-0e5d46c490db&C66545678765&N15998765645&Emaria.eu9@gmail.com;########################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;C99876556782&Ega.augusto@gmail.com&A9bf4efaf-75ea-48d6-8e2b-0f76813e60ef&N15997675654;####################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;Ege.santana@gmail.com&C44565434213;#######################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;N14998786754&Egalmeida@gmail.com;###########################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;Emelissa@gmail.com&C14565436782;#############################################################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {99876556782, 99876556782} {maria.eu9@gmail.com, 66545678765}
[1] {14998786754, 54654367865} {66545678765, 66545678765}
[2] {44565434213, 44565434213} {ge.santana@gmail.com, 44565434213}
[3] {melissa@gmail.com, 14565436782}
[4] {15997675654, 99876556782} {15998765645, 66545678765} {94a9eddc-31dd-4857-a357-0e5d46c490db, 66545678765} {galmeida@gmail.com, 54654367865}
[5] {9bf4efaf-75ea-48d6-8e2b-0f76813e60ef, 99876556782}
[6] {14565436782, 14565436782} {ga.augusto@gmail.com, 99876556782}

-- inserção que causa o redimensionamento da tabela hash
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'A') WHERE cpf = '44565434213';
OK

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;maria.eu9@gmail.com;15998765645;0000000000.00;A94a9eddc-31dd-4857-a357-0e5d46c490db&C66545678765&N15998765645&Emaria.eu9@gmail.com;########################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;C99876556782&Ega.augusto@gmail.com&A9bf4efaf-75ea-48d6-8e2b-0f76813e60ef&N15997675654;####################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;Ege.santana@gmail.com&C44565434213&Ab1157e09-2227-4f49-bbc4-44b32cb65dc0;#################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;N14998786754&Egalmeida@gmail.com;###########################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;Emelissa@gmail.com&C14565436782;#############################################################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {ge.santana@gmail.com, 44565434213}
[1] {9bf4efaf-75ea-48d6-8e2b-0f76813e60ef, 99876556782}
[2]
[3] {melissa@gmail.com, 14565436782}
[4] {maria.eu9@gmail.com, 66545678765}
[5] {14565436782, 14565436782} {44565434213, 44565434213}
[6] {15998765645, 66545678765}
[7] {14998786754, 54654367865} {b1157e09-2227-4f49-bbc4-44b32cb65dc0, 44565434213}
[8] {galmeida@gmail.com, 54654367865}
[9]
[10]
[11] {99876556782, 99876556782}
[12]
[13] {94a9eddc-31dd-4857-a357-0e5d46c490db, 66545678765}
[14] {15997675654, 99876556782} {ga.augusto@gmail.com, 99876556782}
[15]
[16] {66545678765, 66545678765}

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'N') WHERE cpf = '44565434213';
OK

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;maria.eu9@gmail.com;15998765645;0000000000.00;A94a9eddc-31dd-4857-a357-0e5d46c490db&C66545678765&N15998765645&Emaria.eu9@gmail.com;########################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;C99876556782&Ega.augusto@gmail.com&A9bf4efaf-75ea-48d6-8e2b-0f76813e60ef&N15997675654;####################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;Ege.santana@gmail.com&C44565434213&Ab1157e09-2227-4f49-bbc4-44b32cb65dc0&N16996543652;####################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;N14998786754&Egalmeida@gmail.com;###########################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;Emelissa@gmail.com&C14565436782;#############################################################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {ge.santana@gmail.com, 44565434213}
[1] {9bf4efaf-75ea-48d6-8e2b-0f76813e60ef, 99876556782}
[2]
[3] {melissa@gmail.com, 14565436782}
[4] {maria.eu9@gmail.com, 66545678765}
[5] {14565436782, 14565436782} {16996543652, 44565434213} {44565434213, 44565434213}
[6] {15998765645, 66545678765}
[7] {14998786754, 54654367865} {b1157e09-2227-4f49-bbc4-44b32cb65dc0, 44565434213}
[8] {galmeida@gmail.com, 54654367865}
[9]
[10]
[11] {99876556782, 99876556782}
[12]
[13] {94a9eddc-31dd-4857-a357-0e5d46c490db, 66545678765}
[14] {15997675654, 99876556782} {ga.augusto@gmail.com, 99876556782}
[15]
[16] {66545678765, 66545678765}

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'N') WHERE cpf = '14565436782';
OK

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;maria.eu9@gmail.com;15998765645;0000000000.00;A94a9eddc-31dd-4857-a357-0e5d46c490db&C66545678765&N15998765645&Emaria.eu9@gmail.com;########################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;C99876556782&Ega.augusto@gmail.com&A9bf4efaf-75ea-48d6-8e2b-0f76813e60ef&N15997675654;####################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;Ege.santana@gmail.com&C44565434213&Ab1157e09-2227-4f49-bbc4-44b32cb65dc0&N16996543652;####################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;N14998786754&Egalmeida@gmail.com;###########################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;Emelissa@gmail.com&C14565436782&N15997654738;################################################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {15997654738, 14565436782} {ge.santana@gmail.com, 44565434213}
[1] {9bf4efaf-75ea-48d6-8e2b-0f76813e60ef, 99876556782}
[2]
[3] {melissa@gmail.com, 14565436782}
[4] {maria.eu9@gmail.com, 66545678765}
[5] {14565436782, 14565436782} {16996543652, 44565434213} {44565434213, 44565434213}
[6] {15998765645, 66545678765}
[7] {14998786754, 54654367865} {b1157e09-2227-4f49-bbc4-44b32cb65dc0, 44565434213}
[8] {galmeida@gmail.com, 54654367865}
[9]
[10]
[11] {99876556782, 99876556782}
[12]
[13] {94a9eddc-31dd-4857-a357-0e5d46c490db, 66545678765}
[14] {15997675654, 99876556782} {ga.augusto@gmail.com, 99876556782}
[15]
[16] {66545678765, 66545678765}

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'A') WHERE cpf = '54654367865';
OK

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;maria.eu9@gmail.com;15998765645;0000000000.00;A94a9eddc-31dd-4857-a357-0e5d46c490db&C66545678765&N15998765645&Emaria.eu9@gmail.com;########################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;C99876556782&Ega.augusto@gmail.com&A9bf4efaf-75ea-48d6-8e2b-0f76813e60ef&N15997675654;####################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;Ege.santana@gmail.com&C44565434213&Ab1157e09-2227-4f49-bbc4-44b32cb65dc0&N16996543652;####################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;N14998786754&Egalmeida@gmail.com&Af4676990-b9b2-4c1e-8fdd-a8da922f246e;#####################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;Emelissa@gmail.com&C14565436782&N15997654738;################################################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {15997654738, 14565436782} {ge.santana@gmail.com, 44565434213}
[1] {9bf4efaf-75ea-48d6-8e2b-0f76813e60ef, 99876556782}
[2]
[3] {melissa@gmail.com, 14565436782}
[4] {maria.eu9@gmail.com, 66545678765}
[5] {14565436782, 14565436782} {16996543652, 44565434213} {44565434213, 44565434213}
[6] {15998765645, 66545678765}
[7] {14998786754, 54654367865} {b1157e09-2227-4f49-bbc4-44b32cb65dc0, 44565434213}
[8] {galmeida@gmail.com, 54654367865}
[9]
[10] {f4676990-b9b2-4c1e-8fdd-a8da922f246e, 54654367865}
[11] {99876556782, 99876556782}
[12]
[13] {94a9eddc-31dd-4857-a357-0e5d46c490db, 66545678765}
[14] {15997675654, 99876556782} {ga.augusto@gmail.com, 99876556782}
[15]
[16] {66545678765, 66545678765}

UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'C') WHERE cpf = '54654367865';
OK

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;maria.eu9@gmail.com;15998765645;0000000000.00;A94a9eddc-31dd-4857-a357-0e5d46c490db&C66545678765&N15998765645&Emaria.eu9@gmail.com;########################################################################################99876556782;Gabriel Augusto;04/05/1997;ga.augusto@gmail.com;15997675654;0000000000.00;C99876556782&Ega.augusto@gmail.com&A9bf4efaf-75ea-48d6-8e2b-0f76813e60ef&N15997675654;####################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000000000.00;Ege.santana@gmail.com&C44565434213&Ab1157e09-2227-4f49-bbc4-44b32cb65dc0&N16996543652;####################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;N14998786754&Egalmeida@gmail.com&Af4676990-b9b2-4c1e-8fdd-a8da922f246e&C54654367865;########################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;0000000000.00;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000000.00;Emelissa@gmail.com&C14565436782&N15997654738;################################################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;;#############################################################################################################################################################################
\echo index clientes_idx
[0]
[1] {54654367865, 0003}
[2]
[3]
[4]
[5] {99876556782, 0001}
[6] {44565434213, 0002}
[7]
[8]
[9] {66545678765, 0000}
[10] {14565436782, 0005}
[11] {23465784759, 0006}
[12]
[13]
[14]
[15] {37567876542, 0004}
[16]
\echo index chaves_pix_idx
[0] {15997654738, 14565436782} {ge.santana@gmail.com, 44565434213}
[1] {9bf4efaf-75ea-48d6-8e2b-0f76813e60ef, 99876556782}
[2]
[3] {54654367865, 54654367865} {melissa@gmail.com, 14565436782}
[4] {maria.eu9@gmail.com, 66545678765}
[5] {14565436782, 14565436782} {16996543652, 44565434213} {44565434213, 44565434213}
[6] {15998765645, 66545678765}
[7] {14998786754, 54654367865} {b1157e09-2227-4f49-bbc4-44b32cb65dc0, 44565434213}
[8] {galmeida@gmail.com, 54654367865}
[9]
[10] {f4676990-b9b2-4c1e-8fdd-a8da922f246e, 54654367865}
[11] {99876556782, 99876556782}
[12]
[13] {94a9eddc-31dd-4857-a357-0e5d46c490db, 66545678765}
[14] {15997675654, 99876556782} {ga.augusto@gmail.com, 99876556782}
[15]
[16] {66545678765, 66545678765}

-- tentando cadastrar chaves PIX duplicadas novamente
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'A') WHERE cpf = '66545678765';
ERRO: Chave PIX tipo A ja cadastrada para este usuario
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'C') WHERE cpf = '99876556782';
ERRO: Chave PIX tipo C ja cadastrada para este usuario
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'E') WHERE cpf = '44565434213';
ERRO: Chave PIX tipo E ja cadastrada para este usuario
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'E') WHERE cpf = '14565436782';
ERRO: Chave PIX tipo E ja cadastrada para este usuario
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'N') WHERE cpf = '54654367865';
ERRO: Chave PIX tipo N ja cadastrada para este usuario
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'A') WHERE cpf = '99876556782';
ERRO: Chave PIX tipo A ja cadastrada para este usuario
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'N') WHERE cpf = '99876556782';
ERRO: Chave PIX tipo N ja cadastrada para este usuario
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'A') WHERE cpf = '44565434213';
ERRO: Chave PIX tipo A ja cadastrada para este usuario
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'N') WHERE cpf = '44565434213';
ERRO: Chave PIX tipo N ja cadastrada para este usuario
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'N') WHERE cpf = '14565436782';
ERRO: Chave PIX tipo N ja cadastrada para este usuario
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'A') WHERE cpf = '54654367865';
ERRO: Chave PIX tipo A ja cadastrada para este usuario
UPDATE clientes SET chaves_pix = array_append(chaves_pix, 'C') WHERE cpf = '54654367865';
ERRO: Chave PIX tipo C ja cadastrada para este usuario

\q
